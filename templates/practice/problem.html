{% extends "base.html" %}
{% block title %}Problem #{{ problem.id }} - {{ concept.name }}{% endblock %}
{% block content %}
<div class="main-content">
    <h2 class="mb-3">{{ concept.name }} - Problem #{{ problem.id }}</h2>
    <div class="mb-3">{{ problem.question | safe }}</div>
    {% if problem.problem_type == 'multiple_choice' %}
        {% set options = problem.get_options_list() %}
        <div class="list-group mb-3">
            {% for opt in options %}
            <label class="list-group-item">
                <input class="form-check-input me-1" type="radio" name="answer" value="{{ opt }}">
                {{ opt }}
            </label>
            {% endfor %}
        </div>
    {% else %}
        <input type="text" class="form-control mb-3" id="answer-input" placeholder="Your answer">
    {% endif %}
    <button class="btn btn-primary" onclick="submitAnswer()">
        <i class="fas fa-paper-plane me-1"></i>Check Answer
    </button>
    {% if problem.explanation %}
    <button class="btn btn-outline-secondary ms-2" onclick="toggleExplanation()">
        <i class="fas fa-lightbulb me-1"></i>Show Explanation
    </button>
    {% endif %}
    <div id="result" class="mt-3"></div>
    {% if problem.explanation %}
    <div id="explanation" class="mt-3 text-muted" style="display:none;">{{ problem.explanation|safe }}</div>
    {% endif %}
</div>
{% endblock %} 

{% block extra_js %}
<script>
function getAnswer(){
  const radios = document.querySelectorAll("input[name='answer']");
  for (const r of radios) { if (r.checked) return r.value; }
  const text = document.getElementById('answer-input');
  return text ? text.value : '';
}
function submitAnswer(){
  const payload = { answer: getAnswer(), time_taken: 0 };
  fetch('{{ url_for('practice.submit_answer', problem_id=problem.id) }}', {
    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
  }).then(r=>r.json()).then(function(data){
    const el = document.getElementById('result');
    if (!el) return;
    el.innerHTML = data.correct
      ? '<span class="text-success"><i class="fas fa-check-circle me-1"></i>Correct! +'+data.score+' pts</span>'
      : '<span class="text-danger"><i class="fas fa-times-circle me-1"></i>Not quite. Try again.</span>';
  }).catch(function(){
    const el = document.getElementById('result');
    if (el) el.innerHTML = '<span class="text-warning">Error submitting answer.</span>';
  });
}
function toggleExplanation(){
  const el = document.getElementById('explanation');
  if (el) el.style.display = (el.style.display === 'none') ? 'block' : 'none';
}
</script>
{% endblock %}