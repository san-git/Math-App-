{% extends "base.html" %}
{% block title %}Guest Practice - {{ concept.name }}{% endblock %}
{% block content %}
<div class="main-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="fas fa-dumbbell me-2"></i>Practice: {{ concept.name }}</h2>
        <span class="badge bg-info">Guest Mode</span>
    </div>
    <p class="text-muted">Try a few sample problems. Progress is not saved in guest mode.</p>

    {% for problem in problems %}
    <div class="card mb-3">
        <div class="card-body">
            <div class="mb-2 fw-semibold">Q{{ loop.index }}. {{ problem.question|safe }}</div>
            {% if problem.problem_type == 'multiple_choice' %}
                {% set options = problem.get_options_list() %}
                <div class="list-group">
                    {% for opt in options %}
                    <label class="list-group-item">
                        <input class="form-check-input me-1" type="radio" name="p{{ problem.id }}" value="{{ opt }}">
                        {{ opt }}
                    </label>
                    {% endfor %}
                </div>
            {% else %}
                <input type="text" class="form-control mt-2" placeholder="Your answer" name="p{{ problem.id }}-text">
            {% endif %}
            <div class="mt-3 d-flex gap-2">
                <button class="btn btn-primary btn-sm" onclick="submitGuestAnswer({{ problem.id }})">
                    <i class="fas fa-paper-plane me-1"></i>Check Answer
                </button>
                {% if problem.explanation %}
                <button class="btn btn-outline-secondary btn-sm" onclick="toggleExplanation({{ problem.id }})">
                    <i class="fas fa-lightbulb me-1"></i>Show Explanation
                </button>
                {% endif %}
            </div>
            <div id="result-{{ problem.id }}" class="mt-2"></div>
            {% if problem.explanation %}
            <div id="exp-{{ problem.id }}" class="mt-2 text-muted" style="display:none;">{{ problem.explanation|safe }}</div>
            {% endif %}
        </div>
    </div>
    {% endfor %}

    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        Enjoyed this? <a href="{{ url_for('auth.register') }}" class="alert-link">Create a free account</a> to unlock full practice and track your progress.
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function getAnswer(problemId) {
  const radios = document.querySelectorAll("input[name='p" + problemId + "']");
  for (const r of radios) { if (r.checked) return r.value; }
  const text = document.querySelector("input[name='p" + problemId + "-text']");
  return text ? text.value : '';
}
function submitGuestAnswer(problemId) {
  const answer = getAnswer(problemId);
  fetch('/guest/practice/submit/' + problemId, {
    method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({answer})
  }).then(r=>r.json()).then(function(data){
    const el = document.getElementById('result-' + problemId);
    if (!el) return;
    el.innerHTML = data.correct ? '<span class="text-success"><i class="fas fa-check-circle me-1"></i>Correct!</span>' : '<span class="text-danger"><i class="fas fa-times-circle me-1"></i>Not quite, try again.</span>';
  }).catch(function(){
    const el = document.getElementById('result-' + problemId);
    if (el) el.innerHTML = '<span class="text-warning">Error submitting answer.</span>';
  });
}
function toggleExplanation(problemId){
  const el = document.getElementById('exp-' + problemId);
  if (el) el.style.display = (el.style.display === 'none') ? 'block' : 'none';
}
</script>
{% endblock %} 